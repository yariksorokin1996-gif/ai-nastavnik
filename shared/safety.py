CRISIS_CATEGORIES = {
    "suicide": {
        "keywords": [
            "суицид", "суицида", "суициде",
            "убить себя", "убью себя", "хочу умереть", "хочу умер",
            "не хочу жить", "нет смысла жить", "лучше бы меня не было",
            "покончить с собой", "покончу с собой",
            "вскрыть вены", "вскрою вены",
            "таблетки выпить все", "передозировка",
            "прыгнуть", "повеситься",
            "самоповреждение", "режу себя",
        ],
        "response": """Я слышу тебя, и это важно.

То, что ты сейчас переживаешь — очень тяжело. Но сейчас мне важно, чтобы ты поговорила с человеком, который специально обучен помогать в такие моменты.

Телефон доверия (бесплатно, анонимно, 24/7):
8-800-2000-122 (Россия, бесплатно)
8 (495) 988-44-34 (Москва)
+7 (812) 708-40-17 (Санкт-Петербург)

Онлайн-чат: pomoschryadom.ru

Я — инструмент для коучинга, и в этой ситуации тебе нужен живой человек. Пожалуйста, позвони прямо сейчас."""
    },
    "domestic_violence": {
        "keywords": [
            "бьёт меня", "бьет меня", "ударил меня", "ударила меня",
            "душит меня", "душил меня",
            "угрожает убить", "угрожает мне",
            "боюсь его", "боюсь её", "боюсь мужа",
            "поднимает руку", "избивает",
        ],
        "response": """Я слышу тебя. То, что ты рассказываешь — это серьёзно, и ты не должна справляться с этим одна.

Центр помощи пострадавшим от насилия:
8-800-7000-600 (бесплатно, анонимно, 24/7)

Телефон доверия:
8-800-2000-122 (бесплатно, анонимно, 24/7)

Твоя безопасность — главное. Пожалуйста, обратись за помощью."""
    },
    "addiction": {
        "keywords": [
            "не могу бросить пить", "алкоголизм", "спиваюсь",
            "наркотики", "наркозависимость", "сорвалась", "сорвался",
            "передоз", "передозировка наркотик",
            "не могу без алкоголя", "пью каждый день",
        ],
        "response": """Я слышу тебя. Зависимость — это серьёзная тема, и здесь нужна профессиональная помощь.

Наркологическая помощь:
8-800-222-0017 (бесплатно, анонимно)

Телефон доверия:
8-800-2000-122 (бесплатно, 24/7)

Обратиться за помощью — это не слабость, это сила. Пожалуйста, позвони."""
    },
    "eating_disorder": {
        "keywords": [
            "булимия", "анорексия",
            "вызываю рвоту", "не ем", "не могу есть",
            "боюсь еды", "ненавижу своё тело",
            "чистка", "очищение после еды",
        ],
        "response": """Я слышу тебя. Расстройство пищевого поведения — это то, с чем нужна профессиональная помощь.

Психологическая помощь:
8-800-2000-122 (бесплатно, анонимно, 24/7)

Ассоциация РПП: rpp-association.ru

Ты заслуживаешь поддержки специалиста. Пожалуйста, обратись за помощью."""
    },
    "postpartum": {
        "keywords": [
            "ненавижу ребёнка", "ненавижу ребенка",
            "жалею что родила",
            "не чувствую связи с ребёнком", "не чувствую связи с ребенком",
            "не люблю своего ребёнка", "не люблю своего ребенка",
            "хочу бросить ребёнка", "хочу бросить ребенка",
        ],
        "response": """Я слышу тебя. То, что ты чувствуешь, может быть послеродовой депрессией — это не твоя вина, и это лечится.

Психологическая помощь:
8-800-2000-122 (бесплатно, анонимно, 24/7)

Послеродовая депрессия — это медицинское состояние, а не слабость характера. Пожалуйста, поговори со специалистом."""
    },
}

SOFT_CRISIS_SIGNALS = [
    "всё бесполезно", "все бесполезно",
    "ничего не изменится", "никогда не изменится",
    "я устала от жизни", "я устал от жизни",
    "зачем всё это", "зачем все это",
    "нет сил", "нет больше сил",
    "хочу исчезнуть", "хочу пропасть",
]

# Backward compatibility
CRISIS_RESPONSE = CRISIS_CATEGORIES["suicide"]["response"]


def check_crisis(text: str) -> tuple:
    """
    Returns (crisis_type, response) if crisis detected, else (None, None).
    Also checks soft signals and returns ("soft_signal", None) for those.
    """
    text_lower = text.lower()
    for category, data in CRISIS_CATEGORIES.items():
        for keyword in data["keywords"]:
            if keyword in text_lower:
                return category, data["response"]
    for signal in SOFT_CRISIS_SIGNALS:
        if signal in text_lower:
            return "soft_signal", None
    return None, None


def is_crisis_message(text: str) -> bool:
    crisis_type, _ = check_crisis(text)
    return crisis_type is not None and crisis_type != "soft_signal"
